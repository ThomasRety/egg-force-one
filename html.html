<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="css.css">
		<title>Egg force one</title>
	</head>

	<body>
		<div class="menu"></div>
		<div class="info">
			<div class="info2">
				<div class="info3">
					<div class="infoTitre">
						<h3>information</h3>
					</div>
					<div class="infoBody">
						<table>
							<tr>
								<td class="td1"><strong>imprimante Connecté</strong></td>
								<td class="td2"><span>Non connecté</span></td>
							</tr>
						</table>
					</div>
				</div>

				<div class="info3">
					<div class="infoTitre">
						<h3>terminal</h3>
					</div>
					<div class="infoBody">
						<div class="terminal">
							<div class="terminalOutput" id="outputTerm"></div>
							<div class="terminalInput">
								<input class="terminalInput2" type="text" id="inputTerm" placeholder=">">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript" src="/jquery.min.js"></script>
		<script type="text/javascript" src="/socket.io.js"></script>
		<script type="text/javascript">
			var temp = "no temp data"
			var machine = ""

			var socket = io.connect('http://' + document.domain + ':' + location.port);

			// envoi un message pour prevenir qu'on est connecté
			socket.on('connect', function (data) {
				socket.emit('new user', "");
			});

			// reception des message pour le terminal
			socket.on('MsgTerm', function (data) {
				$('#outputTerm').append('<p>' + data + '</p>');
			});


			//reception de la temperature
			socket.on('temp', function (data) {
				temp = data
			});

			// analyse de la commande du terminal
			$('#inputTerm').keypress(function(e) {
				if(e.which == 13) {
					var commande = $('#inputTerm').val();
					$('#inputTerm').val("");
					var argCom = commande.split(" ");
					//alert(argCom)
					switch (argCom[0]) {
						case "help":
							$('#outputTerm').append("<p>" + "help :" + "<br>" + 
								"<dd>" + "temp : donne la temperature" + "<br>" + 
								"<dd>" + "msglvl : choisi le niveau de message afficher" + "</p>");
						break;

						case "temp":
							$('#outputTerm').append('<p>' + temp + '</p>');
						break;

						case "msglvl":
							if (argCom.length == 2) {
								socket.emit('msglvl', argCom[1]);
								$('#outputTerm').append("<p>" + "msglvl " + argCom[1] + " complete" + "</p>");
							}
							else {
								$('#outputTerm').append("<p>" + "usage> msglvl 'int:0,1,2' " + "</p>");
							}
						break;

						case "gcode":
							if (argCom.length >= 2) {
								gcode = commande.substring(commande.indexOf(" "), commande.length);
								alert(argCom[argCom.length - 1]);
								if (argCom[argCom.length - 1] != "\n") {
									gcode += " \\n"
								}
								alert(gcode);
							}
						break;

						default:
							$('#outputTerm').append('<p> commande inconnue </p>');
					}
				}
			});
		</script>
	</body>
</html>